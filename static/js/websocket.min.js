!(function (window) {
    window.WebSocketHandler = function(url, onMessageCallback, onOpenCallback, onCloseCallback, onErrorCallback) {
        // Create WebSocket connection
        let socket = new WebSocket(url);
        
        // Connection opened
        socket.addEventListener('open', function(event) {
            if (typeof onOpenCallback === 'function') {
                onOpenCallback(event);
            }
        });
        
        // Listen for messages
        socket.addEventListener('message', function(event) {
            if (typeof onMessageCallback === 'function') {
                onMessageCallback(event);
            }
        });
        
        // Connection closed
        socket.addEventListener('close', function(event) {
            if (typeof onCloseCallback === 'function') {
                onCloseCallback(event);
            }
        });
        
        // Error handler
        socket.addEventListener('error', function(event) {
            if (typeof onErrorCallback === 'function') {
                onErrorCallback(event);
            }
        });

        return {
            // Add methods to send and close connection
            send: function(data) {
                socket.send(JSON.stringify(data));
            },
            close: function() {
                socket.close();
            }
        }
    }
})(window);